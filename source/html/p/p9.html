<html>

<head>
    <link rel="stylesheet" href="/source/css/p/p9.css">
    <title>Планирование клиентских ОС</title>
</head>

<body>

    <div class="grid"></div>

    <h1>Планирование клиентских ОС</h1>
    <h2>Цель: научиться планированию и развертыванию клиентских ОС с помощью MDT</h2>
    <h3>Задание:
        <br><br>
        Развернуть клиентскую ОС с помощью Microsoft Deployment Toolkit
    </h3>
    <h4>Выполнение работы:
        <br><br>
        В первую очередь нужно на сервере под управлением Windows Server 2012 R2
        установить роль Windows Deployment Services. Установку роли можно выполнить из
        консоли Server Manager. В списке ролей выберите Windows Deployment Services и
        нажмите Next.
        <br><br>
        В списке устанавливаемых компонентов роли WDS отметьте службы Deployment
        Server и Transport Server.
        <br><br>
        Запустите установку роли WDS (занимает пару минут).
        <br><br>
        Совет. Роль Windows Deployment Services можно установить с помощью всего
        одной команды PowerShell:
        Install-WindowsFeature -Name WDS -IncludeManagementTools
        Установка Microsoft Deployment Toolkit 2013
        Установите Microsoft Deployment Toolkit (MDT) 2013 Update 1 со стандартными
        настройками, для чего достаточно скачать и запустить с правами администратора
        файл MicrosoftDeploymentToolkit2013_x64.
        <br><br>
        Установка Windows Assessment and Deployment Kit
    </h4>
    <h5>Далее нужно установить Windows Assessment and Deployment Kit (Windows ADK)
        для Windows 10. Скачайте и запустите файл adksetup.exe.
        Укажите каталог для установки (по умолчанию C:\Program Files (x86)\Windows
        Kits\10\).
        <br><br>
        В списке компонентов ADK для установки отметьте:
        Deployment tools –используется для настройки образа Windows и автоматизации
        развертывания образа
        Windows Preinstallation Environment (Windows PE) – среда WinPE — минимальная
        ОС, разработанная для подготовки компьютера к установке Windows или обслуживания
        User State Migration tool (USMT) – набор инструментов для миграции данных
        пользователей между системами
        <br><br>
        Запустите установке Windows ADK.
        <br>
        Теперь нам нужен дистрибутив Windows 10. В нашем примере это будет Windows
        10 x64 Pro. Т.к. MDT не позволяет напрямую работать с iso файлами образа Windows,
        необходимо распаковать установочные файлы. Самый простой вариант – смонтировать
        файл с iso образом Windows 10 через File Explorer (Проводник) в отдельный виртуальный
        драйв (ПКМ по iso файлу-> Mount).
        <br><br>
        Настройка MDT 2013
        <br>
        Приступим к настройке MDT 2013. Запустим консоль Deployment Workbench,
        щелкнем ПКМ по Deployment Share и создадим новый каталог (New Deployment Share).
        <br>
        В окне мастера создания нового каталога распространения укажите путь к папке
        (C:\DeploymentShare в нашем случае).
        <br>
        Укажите сетевое имя каталога (мы оставили имя по умолчанию DeploymentShare$)
        и нажмите Next.
        Совет. Знак “$” в имени сетевой папки означает, что она будет скрыта от
        пользователей.
        <br>
        После окончания работы мастера перейдите в папку C:\DeploymentShare.
    </h5>
    <h6>В этой папке хранятся образы ОС, драйвера, настройки, пакеты с приложениями и
        т.д. Папка является портабельной и может быть легко перенесена на другой MDT сервер.
        Чтобы все сетевые клиенты (в том числе анонимные) могли обращаться к
        содержимому этой папке, в свойствах сетевой папки DeploymentShare$, нужно добавить
        группу Everyone с разрешением на чтение.
        <br><br>
        На следующем шаге нам нужно импортировать образ Windows 10. MDT
        поддерживает импорт образа операционной системы непосредственно с диска
        дистрибутива, wim файла или образа wds.
        Разверните Deployment Shares -> MDT Deployment share. ПКМ по разделу Operating
        systems и в меню выберите Import Operating System.
        <br><br>
        Выберите пункт Full set of source files и укажите имя драйва, на который был
        смонтирован iso образ Windows 10.
        <br><br>
        Укажите имя каталога, в котором будет храниться импортируемый образ.
        <br><br>
        Мастер скопирует файлы дистрибутива Windows 10 в каталог
        C:\DeploymentShare\Operating Systems\Windows10Prox64, а в разделе Operating Systems
        появится новый запись, указывающая на образ Windows 10 Pro x64.
        <br><br>
        Создание задания установки MDT
        <br>
        Теперь нужно создать задание установки (Task Sequence), представляющее собой
        последовательность действий, необходимых для разворачивания Windows (это установка
        ОС, драйверов, приложений, конфигурация системы, обновлений, запуск различных
        скриптов настройки и т.п.).
        Щелкните ПКМ по разделу Task Sequences и выберите New Task Sequence.
        <br><br>
        В качестве идентификатора задания (Task sequence ID) укажем DeployWin10x64, а
        имени (Task sequence name) — “Deploy Windows 10 x64”.
        <br><br>
        В выпадающем меню нужно выбрать один из существующих шаблонов заданий
        установки. В нашем случае это будет Standard Client Task Sequence.
        <br><br>
        Выберите ОС, которую нужно установить в рамках этого задания (Windows 10 Pro
        x64).
        <br><br>
        Затем можно указать ключ продукта, это может быть как retail, MAK или KMS
        ключ.
    </h6>
    <h7>Далее можно задать пароль локального администратора на устанавливаемой
        системе.
        <br>
        Совет. Имейте в виду, что пароль хранится в открытом виде в файле Unattend.xml,
        поэтому стоит задать простой пароль локального администратора, который после ввода
        компьютера в домен будет автоматически измен с помощью MS LAPS.
        <br><br>
        Откройте свойства созданного задания и проверьте, что его запуск разрешён на
        любых платформах (This can run on any platforms).
        <br><br>
        На вкладке Task Sequence отображается последовательность шагов, определенных
        в шаблоне, которые нужно выполнить при разворачивании ОС на клиенте. Здесь можно
        добавить собственные шаги, либо оставить все по-умолчанию.
        <br><br>
        Далее нужно обновить каталок распространения MDT. Щелкните ПКМ по MDT
        Deployment Share и выберите Update Deployment Share. MDT сгенерирует загрузочные
        образы и файлы, нужные для установки ОС.
        <br><br>
        При первом запуске каталог C:\DeploymentShare\Boot пуст, поэтому нужно выбрать
        пункт Completely regenerate the boot image и дождаться генерации образов ОС.
        <br><br>
        В каталоге C:\DeploymentShare\Boot должны появится iso и wim образы Windows
        PE для x86 и x64 платформ. Эти образы могут быть использованы для загрузки
        физических или виртуальных машин при разворачивании образа. При разворачивании
        образа Windows по сети (PXE boot) с помощью Windows Deployment Services могут быть
        использованы wim файлы.
        <br><br>
        Совет. Т.к. мы планируем использовать загрузку PXE booting, нам понадобятся
        только wim файлы LiteTouchPE_x64.wim и LiteTouchPE_x86.wim.
        Настройка загрузочного образа в Windows Deployment Services
        Следующий этап – настройка сервера WDS, который должен обслуживать запросы
        клиентов PXE. Откройте консоль Windows Deployment Services (Server Manager -> Tools -
        <br><br>
        > Windows Deployment Services), разверните ветку Servers и в контекстном меню сервера
        выберите Configure Server.
        <br><br>
        Укажем, что это будет отдельный WDS сервер (Standalone Server), не зависимый от
        Active Directory.
        <br><br>
        Каталог установки оставим без изменений — C:\RemoteInstall.
        <br><br>
        В настройках клиента PXE нужно указать, что нужно отвечать на запросы всех
        клиентов — Respond to all clien computers (known and unknown).
        <br><br>
        Совет. В среде Active Directory было бы безопаснее использовать опцию Respond
        only to known client computer.
        Снимите галку– Add images to the server now.
        <br><br>
        Зеленый треугольник на имени WDS сервера означает, что он настроен и запущен.
        <br><br>
        Теперь нам нужно импортировать на WDS сервер загрузочный образ, который мы
        создали ранее с помощью MDT. Щелкните ПКМ по Boot Image –> Add boot image.
        <br><br>
        Перейдите в каталог C:\DeploymentShare\Boot и последовательно добавьте
        файлы LiteTouchPE_x86.wim и LiteTouchPE_x64.wim.
        <br><br>
        Последнее, что осталось выполнить – открыть свойства WDS сервера и перейти на
        вкладку Boot. Чтобы предотвратить случайную загрузку клиентов через PXE и
        автоматическую установку Windows, зададим обязательное использование
        клавиши F12 для использования PXE-загрузки. Для этого в секции PXE Boot Policy нужно
        выбрать опцию Require the user to press the F12 key to continue the PXE boot.
        Здесь же укажите загрузочные образы для архитектур x86 и x64 (в том числе для
        архитектуры UEFI).
        <br><br>
        Все остальные настройки WDS сервера оставим по-умолчанию. Перезапустите
        службу WDS через консоль (All tasks ->Restart).
        <br><br>
        Важно. WDS сервер и клиентский компьютер, на который вы хотите установить
        ОС через PXE, должны находится в одной подсети (VLAN). Если они расположены в
        разных подсетях, нужно настроить DHCP-relay (IP Helper) с дополнительными DHCP
        опциями 60 и 67.
        Тестирование установки Windows 10 по сети
        Теперь мы готовы протестировать сетевую загрузку компьютера клиента с wim
        образа, расположенного на WDS сервере (PXE boot). В этом тесте это будет виртуальная
        машина VMWare. Запустите ВМ и в процессе загрузи несколько раз нажмите клавишу F12
        для начала загрузки через PXE.
        Press F12 for network service boot
        <br><br>
        Совет. Т.к. экран загрузки в ВМ проскакивает слишком быстро, практически
        нереально успеть нажать кнопку F12. Поэтом в настройках ВМ предпочтительно задать
        наивысший приоритет для загрузочного устройства Network boot from Intel E1000.
        <br><br>
        Машина подключится к WDS серверу и получит список доступных загрузочных
        образов Windows PE. В стандартном диалоге Boot Manager нужно быте выбрать ОС,
        которую нужно загрузить. В нашем случае это Lite Touch Windows PE (x86).
        <br><br>
        Система начнет загрузку по сети wim образа со средой WinPE и предложит начать
        установку Windows 10 с помощью мастера Microsoft Deployment Tool Wizard.
        <br><br>
        Нажмите на кнопку Run the Deployment Wizard to install a new Operating System для
        запуска пошагового мастера установки образа Windows 10 на компьютер клиента.
        <br><br>
        В нашем примере также понадобилось указать UNC путь к сетевой папке
        DeploymentShare$ на MDT сервере(\\10.1.24.170\DeploymentShare$) и имя+пароль
        пользователя для доступа к ней.
        <br><br>
        Осталось среди доступных заданий выбрать созданное ранее Deploy Windows 10
        x64 и дождаться окончания сетевой установки образа Windows 10 на этот компьютер.
        <br><br>
        Итак, в этой статье мы показали, как воспользоваться функционалом MDT 2013 и
        WDS сервера для создания инфраструктуры, позволяющей в автоматическом режиме по
        сети развернуть образ Windows 10 на клиентах.
    </h7>

    <div class="button-back-page">
        <a class="div-frame" href="/source/html/second.html" />
    </div>

    <h7 class="xh1"></h7>
</body></html>
