<html>

<head>
    <link rel="stylesheet" href="/source/css/p/p6.css">
    <title>Создание эталонного образа Windows</title>
</head>

<body>

    <div class="grid"></div>

    <h1>Создание эталонного образа Windows</h1>
    <h2>Цель: научиться созданию эталонного образа и файла ответов с помощью Windows
        SIM в Sysprep</h2>
    <h3>Задание:
        <br><br>
        Создать кастомный файл ответов unattend.xml с помощью Windows System Image
        Manager (Windows SIM).
    </h3>
    <h4>Выполнение работы:
        <br><br>
        Открываем Windows Assessment and Deployment Kit (Windows ADK).
        <br>
        После запуска Windows SIM выбираем Select Windows Image
        <br>
        Можно взять wim файл с Windows 10 media (с диска/iso) или захваченный WIM
        файл Windows 10. Если вы это делаете первый раз, то получите сообщение о «Catalog File
        being missing», ничего страшного, соглашаемся и ждем пока он будет создан.
        <br>
        Из меню выберем New Answer File
        <br>
        В разделе Windows Image, разворачиваем Components и ищем amd64_Microsoft-
        Windows-Shell-Setup_6.2.9200.16384_neutral (для Windows 8.1) и amd64_Microsoft-
        Windows-Shell-Setup_10.0.10586.0_neutral (для Windows 10 1511).
        <br>
        Правой кнопкой по разделу OOBE и выбираем Add Setting to Pass 7 oobeSystem
        <br>
        Нас интересует значение HideWirelessSetupInOOBE в значении true, это настройка
        и спрячет не нужный нам экран
        <br>
        Далее, сохраняем файл ответов, чтобы создать пакет в SCCM
    </h4>
    <h5>Создаем пакет (Create Package) в SCCM, чтобы в дальнейшем его использовать в
        последовательности задач с Windows 10
        <br><br>
        Указываем путь до папки с xml файлом
        <br><br>
        Выбираем опцию Do not create a program, т.к. внутри мы ничего устанавливать не
        будем
        <br>
        И обязательно не забываем выполнить доставку пакета (Distribute Content) на точку
        распространения
        <br><br>
        Теперь пора добавить этот пакет внутрь последовательности задач
        <br>
        Нас интересует шаг Apply Operating System Image и раздел с файлом автоответа.
        Через Browse выбираем пакет, которой только что создали и в поле File Name указываем
        имя xml файла.
        <br>
        Всё.
    </h5>
    <h6>Запуск утилиты
        <br><br>
        Запуск Sysprep проще всего осуществить с помощью команды Win+R.
        <br>
        Таким образом в проводнике получим непосредственный доступ к файлу её
        запуска.
        <br><br>
        Отвязка от комплектующих
        <br>
        Чтобы отвязать Windows от текущих комплектующих перед их заменой или
        созданием бэкапа системы для переноса на другое устройство, используем «Переход в
        окно OOBE» и выбираем завершение работы.
        <br><br>
        При таком раскладе утилита осуществит только сброс драйверов комплектующих.
        Если же выставить галочку опции «Подготовка к использованию», будет проведён ряд
        мероприятий для передачи системы новому пользователю - чистка системного журнала и
        временных файлов, удаление точек восстановления, обнуление SID, сброс активации и
        т.п.
        <br><br>
        Утилита выполнит свою работу, и компьютер выключится. Далее можно
        приступать к тем или иным действиям – менять комплектующие, бэкапить систему с
        загрузочного носителя. С новым включением – как на исходном устройстве, так и на том,
        куда система переносилась с помощью восстановления из бэкапа – сначала будем
        лицезреть, как устанавливаются драйверы на новые комплектующие, а затем попадём в
        окно OOBE. Окно OOBE - это не что иное, как экран приветствия системы, который мы
        обычно видим на завершающем этапе установки Windows, где нужно указать
        региональные данные и создать свою учётную запись.
    </h6>
    <h7>И поскольку при замене комплектующих или восстановлении Windows на других
        компьютерах в создании новой учётной записи нужды нет, спокойно можем сбросить этот
        <br>
        процесс клавишами Ctrl+Shift+F3. Это клавиши входа в скрытую учётную запись
        администратора. Система попробует подгрузить её, но в доступе откажет. Жмём «Ок».
        <br><br>
        И после перезапуска увидим привычный экран блокировки со всеми
        существующими учётными записями.
        Режим аудита
        Режим аудита предоставляет возможность получить доступ к среде Виндовс без
        создания учётной записи конкретного пользователя, в режиме упомянутой учётной записи
        администратора.
        <br>
        В этом режиме, собственно, и проводится OEM-производителями и IT-
        специалистами компаний настройка эталонного образа системы с нужными драйверами,

        параметрами и внедрённым софтом. Первичный вход в режим аудита выполняется на
        этапе установки Windows - той, что впоследствии должна стать эталонным образом, и на
        которой не должно существовать никаких пользовательских учётных записей и
        идентифицирующих данных. После этапа подготовки устройств попадём на завершающий
        <br>
        этап установки системы, начинающийся с задания региональных настроек. И здесь жмём
        клавиши Ctrl+Shift+F3.
        <br><br>
        После перезагрузки попадём в режим аудита. Последний загружается с по
        умолчанию запущенным окном Sysprep для удобства. Вот, собственно, в таком режиме и
        можно приступать к модификации Windows. Если в процессе внесения правок в систему,
        например, при установке определённого софта потребуется перезагрузка, всё, что нужно
        сделать – это закрыть окно утилиты. И осуществить перезагрузку привычным образом.
        После перезагрузки система вновь запустится в режиме аудита. Завершается работа в этом
        режиме так, как было рассмотрено в предыдущем пункте статьи – выбором в
        окне Sysprep экрана OOBE. И обычно с применением опции подготовки к использованию.
        <br><br>
        Эталонную модифицированную Windows обычно делают с чистой, только что
        установленной системы. Но возможен вариант создания эталона на базе наработанной
        системы. Для этого внутри рабочей Виндовс необходимо запустить Sysprep и выбрать в её
        окне переход в режим аудита. Завершающий работу параметр - перезагрузка.
        <br><br>
        Войдя в режим аудита, можем удалить учётные записи тех пользователей, которые
        доселе работали с системой, донастроить что нужно, а затем выполнить отвязку от
        комплектующих (и при необходимости от идентифицирующих данных) с переходом в
        окно OOBE.
        Вот только не с каждой рабочей системы удастся сделать эталонный образ. У этого
        механизма есть свои ограничения.
        Решение проблем с запуском Sysprep
        Sysprep, увы, не сработает, если Windows была не установлена начисто, а
        обновлена с предыдущей версии, клонирована или восстановлена из бэкапа, созданного на
        другом железе. В таких случаях при запуске утилиты обычно получим такое вот
        уведомление.
        <br><br>
        В таком случае можно кое-что предпринять, правда, без гарантированного успеха
        во всех 100% случаев.
        Создаём бэкап системы или хотя бы запасаемся точкой восстановления, поскольку
        далее будем работать с системным реестром.
        Запускаем его.
        Раскрываем путь:
        HKEY_LOCAL_MACHINE\SYSTEM\Setup
        Если система обновлялась с предыдущей версии, в первую очередь в самом
        каталоге «Setup» удаляем параметр «Upgrade».
        <br><br>
        Затем раскрываем каталог «Setup», кликаем подкаталог «Status», здесь нам нужен
        параметр «CleanupState». Устанавливаем его значение 7.
        <br><br>
        Если такого параметра нет, создаём его. В контекстном меню окна реестра
        жмём «Создать», затем – «Параметр DWORD (32 бита)».
        <br><br>
        Даём имя параметру «CleanupState».
        <br><br>
        Устанавливаем его значение 7. После перезагрузки снова пробуем
        запустить Sysprep.
    </h7>

    <div class="button-back-page">
        <a class="div-frame" href="/source/html/second.html" />
    </div>

    <h7 class="xh1"></h7>
</body></html>
